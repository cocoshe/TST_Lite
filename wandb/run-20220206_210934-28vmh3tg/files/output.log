train.py:86: DtypeWarning: Columns (1,2,3) have mixed types.Specify dtype option on import or set low_memory=False.
  train_data, val_data, timestamp, scaler = get_data(args, input_window, output_window, device=device)
D:\PythonProject\Time_series_anomaly_detection\weights\2022_02_06 21_09_43
find port id.
find polution id.
find company id.
         company_id                port_id polution_id       date  concentration   amount
0    17280000089583  64000000000600100000       w00000 2020-01-01          66.25   870.00
1    17280000089583  64000000000600100000       w00000 2020-01-02          73.18  1758.00
2    17280000089583  64000000000600100000       w00000 2020-01-03          79.95  1918.00
3    17280000089583  64000000000600100000       w00000 2020-01-04          69.91  1678.00
4    17280000089583  64000000000600100000       w00000 2020-01-05            NaN    74.00
5    17280000089583  64000000000600100000       w00000 2020-01-06            NaN   152.00
6    17280000089583  64000000000600100000       w00000 2020-01-20            NaN   156.00
7    17280000089583  64000000000600100000       w00000 2020-01-21            NaN    80.00
168  17280000089583  64000000000600100000       w00000 2020-01-07          34.50  2976.00
169  17280000089583  64000000000600100000       w00000 2020-01-08         112.50  9724.90
170  17280000089583  64000000000600100000       w00000 2020-01-09          26.80  2314.00
171  17280000089583  64000000000600100000       w00000 2020-01-10          22.40  1944.00
172  17280000089583  64000000000600100000       w00000 2020-01-11          20.60  1780.00
173  17280000089583  64000000000600100000       w00000 2020-01-12          19.30  1668.00
174  17280000089583  64000000000600100000       w00000 2020-01-13          20.20  1744.00
175  17280000089583  64000000000600100000       w00000 2020-01-14          21.70  1876.39
176  17280000089583  64000000000600100000       w00000 2020-01-15          33.80  2920.00
177  17280000089583  64000000000600100000       w00000 2020-01-16          32.10  2776.00
178  17280000089583  64000000000600100000       w00000 2020-01-17          20.50  1774.00
179  17280000089583  64000000000600100000       w00000 2020-01-18          23.70  2052.00
180  17280000089583  64000000000600100000       w00000 2020-01-19          29.80  2570.00
181  17280000089583  64000000000600100000       w00000 2020-01-22          24.80  2144.96
182  17280000089583  64000000000600100000       w00000 2020-01-23          20.90  1806.00
183  17280000089583  64000000000600100000       w00000 2020-01-24          19.50  1690.00
184  17280000089583  64000000000600100000       w00000 2020-01-25          19.80  1712.00
185  17280000089583  64000000000600100000       w00000 2020-01-26          27.70  2396.00
186  17280000089583  64000000000600100000       w00000 2020-01-27          45.00  3888.00
187  17280000089583  64000000000600100000       w00000 2020-01-28          20.40  1762.00
188  17280000089583  64000000000600100000       w00000 2020-01-29          22.80  1970.00
189  17280000089583  64000000000600100000       w00000 2020-01-30          20.10  1736.00
190  17280000089583  64000000000600100000       w00000 2020-01-31          20.50  1776.00
191  17280000089583  64000000000600100000       w00000 2020-02-01          20.60  1782.00
dim_name:  concentration
-----------------------------------------------
series:  0       66.25
1       73.18
2       79.95
3       69.91
4        0.00
5        0.00
6        0.00
7        0.00
168     34.50
169    112.50
170     26.80
171     22.40
172     20.60
173     19.30
174     20.20
175     21.70
176     33.80
177     32.10
178     20.50
179     23.70
180     29.80
181     24.80
182     20.90
183     19.50
184     19.80
185     27.70
186     45.00
187     20.40
188     22.80
189     20.10
190     20.50
191     20.60
Name: concentration, dtype: float64
series.shape:  (32,)
-----------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch   1 | time:  0.11s | valid loss 16.54534
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch   2 | time:  0.09s | valid loss 2.02277
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch   3 | time:  0.09s | valid loss 0.38124
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch   4 | time:  0.10s | valid loss 0.49400
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch   5 | time:  0.10s | valid loss 0.17561
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch   6 | time:  0.10s | valid loss 0.66972
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch   7 | time:  0.10s | valid loss 0.81558
-----------------------------------------------------------------------------------------
D:\PythonProject\Time_series_anomaly_detection\utils\data_prepare.py:18: UserWarning: Creating a tensor from a list of numpy.ndarrays is extremely slow. Please consider converting the list to a single numpy.ndarray with numpy.array() before converting to a tensor. (Triggered internally at  ..\torch\csrc\utils\tensor_new.cpp:201.)
  return torch.FloatTensor(inout_seq)
-----------------------------------------------------------------------------------------
| end of epoch   8 | time:  0.10s | valid loss 0.43970
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch   9 | time:  0.08s | valid loss 0.15874
-----------------------------------------------------------------------------------------
save successfully
loss shape:  (30,)
-----------------------------------------------------------------------------------------
| end of epoch  10 | time:  2.56s | valid loss 0.38312
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  11 | time:  0.09s | valid loss 0.42610
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  12 | time:  0.09s | valid loss 0.37383
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  13 | time:  0.09s | valid loss 0.24021
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  14 | time:  0.09s | valid loss 0.14822
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  15 | time:  0.09s | valid loss 0.22198
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  16 | time:  0.09s | valid loss 0.34298
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  17 | time:  0.09s | valid loss 0.39387
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  18 | time:  0.09s | valid loss 0.37146
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  19 | time:  0.09s | valid loss 0.30331
-----------------------------------------------------------------------------------------
loss shape:  (30,)
-----------------------------------------------------------------------------------------
| end of epoch  20 | time:  2.59s | valid loss 0.27408
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  21 | time:  0.09s | valid loss 0.16509
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  22 | time:  0.09s | valid loss 0.14563
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  23 | time:  0.09s | valid loss 0.15678
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  24 | time:  0.09s | valid loss 0.16420
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  25 | time:  0.09s | valid loss 0.16252
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  26 | time:  0.09s | valid loss 0.15458
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  27 | time:  0.09s | valid loss 0.14667
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  28 | time:  0.09s | valid loss 0.14772
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  29 | time:  0.09s | valid loss 0.15840
-----------------------------------------------------------------------------------------
loss shape:  (30,)
-----------------------------------------------------------------------------------------
| end of epoch  30 | time:  2.42s | valid loss 0.20425
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  31 | time:  0.08s | valid loss 0.16814
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  32 | time:  0.17s | valid loss 0.16194
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  33 | time:  0.08s | valid loss 0.15298
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  34 | time:  0.09s | valid loss 0.14624
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  35 | time:  0.09s | valid loss 0.14587
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  36 | time:  0.09s | valid loss 0.14783
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  37 | time:  0.08s | valid loss 0.14818
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  38 | time:  0.09s | valid loss 0.14660
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  39 | time:  0.11s | valid loss 0.14529
-----------------------------------------------------------------------------------------
save successfully
loss shape:  (30,)
-----------------------------------------------------------------------------------------
| end of epoch  40 | time:  2.85s | valid loss 0.17992
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  41 | time:  0.10s | valid loss 0.15085
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  42 | time:  0.10s | valid loss 0.15205
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  43 | time:  0.10s | valid loss 0.15004
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  44 | time:  0.10s | valid loss 0.14672
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  45 | time:  0.09s | valid loss 0.14513
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  46 | time:  0.11s | valid loss 0.14529
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  47 | time:  0.10s | valid loss 0.14546
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  48 | time:  0.09s | valid loss 0.14501
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  49 | time:  0.09s | valid loss 0.14484
-----------------------------------------------------------------------------------------
save successfully
loss shape:  (30,)
-----------------------------------------------------------------------------------------
| end of epoch  50 | time:  2.38s | valid loss 0.17829
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  51 | time:  0.09s | valid loss 0.14745
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  52 | time:  0.09s | valid loss 0.14793
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  53 | time:  0.09s | valid loss 0.14686
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  54 | time:  0.09s | valid loss 0.14508
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  55 | time:  0.09s | valid loss 0.14391
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  56 | time:  0.08s | valid loss 0.14342
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  57 | time:  0.10s | valid loss 0.14303
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  58 | time:  0.10s | valid loss 0.14259
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  59 | time:  0.09s | valid loss 0.14245
-----------------------------------------------------------------------------------------
save successfully
loss shape:  (30,)
-----------------------------------------------------------------------------------------
| end of epoch  60 | time:  2.56s | valid loss 0.17417
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  61 | time:  0.09s | valid loss 0.14246
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  62 | time:  0.09s | valid loss 0.14136
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  63 | time:  0.09s | valid loss 0.13933
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  64 | time:  0.10s | valid loss 0.13676
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  65 | time:  0.10s | valid loss 0.13635
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  66 | time:  0.09s | valid loss 0.13113
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  67 | time:  0.10s | valid loss 0.12919
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  68 | time:  0.11s | valid loss 0.13161
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  69 | time:  0.11s | valid loss 0.14174
-----------------------------------------------------------------------------------------
loss shape:  (30,)
-----------------------------------------------------------------------------------------
| end of epoch  70 | time:  2.48s | valid loss 0.16153
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  71 | time:  0.10s | valid loss 0.13317
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  72 | time:  0.10s | valid loss 0.14435
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  73 | time:  0.09s | valid loss 0.13865
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  74 | time:  0.22s | valid loss 0.13062
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------
| end of epoch  75 | time:  0.10s | valid loss 0.12584
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  76 | time:  0.11s | valid loss 0.12315
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  77 | time:  0.09s | valid loss 0.12038
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  78 | time:  0.09s | valid loss 0.11740
-----------------------------------------------------------------------------------------
save successfully
-----------------------------------------------------------------------------------------
| end of epoch  79 | time:  0.10s | valid loss 0.11674
-----------------------------------------------------------------------------------------
save successfully
loss shape:  (30,)
Traceback (most recent call last):
  File "D:\miniconda\envs\pytorch\lib\site-packages\PIL\ImageFile.py", line 495, in _save
    fh = fp.fileno()
AttributeError: '_idat' object has no attribute 'fileno'
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "train.py", line 139, in <module>
    main(args)
  File "train.py", line 104, in main
    val_loss = plot_and_loss(model, val_data, epoch, criterion, input_window, timestamp, scaler, args.dim)
  File "D:\PythonProject\Time_series_anomaly_detection\utils\plot_and_loss.py", line 58, in plot_and_loss
    plt.savefig('graph/transformer-epoch%d_%s.png' % (epoch, dim))
  File "D:\miniconda\envs\pytorch\lib\site-packages\matplotlib\pyplot.py", line 958, in savefig
    res = fig.savefig(*args, **kwargs)
  File "D:\miniconda\envs\pytorch\lib\site-packages\matplotlib\figure.py", line 3019, in savefig
    self.canvas.print_figure(fname, **kwargs)
  File "D:\miniconda\envs\pytorch\lib\site-packages\matplotlib\backend_bases.py", line 2325, in print_figure
    **kwargs)
  File "D:\miniconda\envs\pytorch\lib\site-packages\matplotlib\backend_bases.py", line 1648, in wrapper
    return func(*args, **kwargs)
  File "D:\miniconda\envs\pytorch\lib\site-packages\matplotlib\_api\deprecation.py", line 412, in wrapper
    return func(*inner_args, **inner_kwargs)
  File "D:\miniconda\envs\pytorch\lib\site-packages\matplotlib\backends\backend_agg.py", line 543, in print_png
    dpi=self.figure.dpi, metadata=metadata, pil_kwargs=pil_kwargs)
  File "D:\miniconda\envs\pytorch\lib\site-packages\matplotlib\image.py", line 1675, in imsave
    image.save(fname, **pil_kwargs)
  File "D:\miniconda\envs\pytorch\lib\site-packages\PIL\Image.py", line 2212, in save
    save_handler(self, fp, filename)
  File "D:\miniconda\envs\pytorch\lib\site-packages\PIL\PngImagePlugin.py", line 1348, in _save
    ImageFile._save(im, _idat(fp, chunk), [("zip", (0, 0) + im.size, 0, rawmode)])
  File "D:\miniconda\envs\pytorch\lib\site-packages\PIL\ImageFile.py", line 509, in _save
    l, s, d = e.encode(bufsize)
KeyboardInterrupt